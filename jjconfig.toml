#:schema https://docs.jj-vcs.dev/latest/config-schema.json

[user]
name = "David Nguyen"
email = "david2456@gmail.com"

[[--scope]]
--when.repositories = ["/Users/david.nguyen/go/src/github.com/DataDog"]

[--scope.user]
email = "david.nguyen@datadoghq.com"

[--scope.signing]
behavior = "own"
backend = "ssh"
key = "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIC+MNGBrTEwWXjCWynzMdFGu4tt1dI1ZE5ghj6RORt75"

[revset-aliases]
'wip' = 'mutable()'
'wip_heads' = 'heads(wip)'
'branch(b)' = 'trunk()..bookmarks(b)'
# Get the merge commit that introduced a specific commit x into trunk
'merge(x)' = 'roots(merges() & trunk() & x::)'
# Find two specific commits and their merge commits to see which one was included first
'cmp(x, y)' = 'merge(x)|merge(y)|x|y'
'mymerges' = 'children(mine()) & merges() & ::trunk()'
# Check which of my merges included a specific commit x
'check(x)' = 'mymerges|x'
'me' = 'mine()'
'allme' = 'mymerges|me'

[aliases]
'mm' = ['new', 'wip_heads', '-m', 'megamerge']
'rba' = ['rebase', '-r', 'wip', '-d', 'trunk()']
'a' = ['log', '-r', 'all()']
'tug' = ["bookmark", "move", "--from", "heads(::@- & bookmarks())", "--to", "@"]

[git]
# Prevent pushing work in progress or anything explicitly labeled "private"
private-commits = "description(glob:'wip:*') | description(glob:'private:*')"

[templates]
draft_commit_description = '''
concat(
  builtin_draft_commit_description,
  "\nJJ: ignore-rest\n",
  diff.git(),
)
'''
git_push_bookmark = """
  truncate_end(
    244,
    separate(
      "/",
      "dang",
      jira_issue_prefix(description),
      first_line_suffix(description),
    ),
  )
"""

[template-aliases]
"jira_issue_prefix(description)" = """
  description
    .match(regex:"^[[:upper:]]+-[[:digit:]]+[[:blank:]]+")
    .replace(regex:"[[:blank:]]+", "")
"""
"first_line_suffix(description)" = """
  description
    .first_line()
    .remove_prefix(jira_issue_prefix(description))
    .lower()
    .replace(regex:"[[:^word:]]", "-")
    .replace(regex:"-+", "-")
    .replace(regex:"^-|-$", "")
"""
# Based on builtin_log_oneline with some modifications. Can be used in prompt
# https://github.com/jj-vcs/jj/blob/06bd4ceb8e2aabf0639ac60cacf810e796ede6b6/cli/src/config/templates.toml#L159-L189
"compact_log_oneline" = """
if(self.root(),
  format_root_commit(self),
  label(
    separate(" ",
      if(self.current_working_copy(), "working_copy"),
      if(self.immutable(), "immutable", "mutable"),
      if(self.conflict(), "conflicted"),
    ),
    separate(" ",
      if(self.immutable(), label("warning heading", "immutable")),
      format_short_change_id_with_hidden_and_divergent_info(self),
      if(self.empty(), empty_commit_marker),
      if(self.description(),
        self.description().first_line(),
        label(if(self.empty(), "empty"), description_placeholder),
      ),
      self.bookmarks(),
      self.tags(),
      self.working_copies(),
      if(self.conflict(), label("conflict", "conflict")),
    ) ++ "\n",
  )
)
"""


[fsmonitor]
backend = "watchman"
[fsmonitor.watchman]
register-snapshot-trigger = true

[colors]
"diff removed token" = { underline = false }
"diff added token" = { underline = false }
"diff token" = { underline = false }

[ui]
default-command = "log"
diff-formatter = ":git"
revsets-use-glob-by-default = true

[fix.tools.gofmt]
command = ["gofmt"]
patterns = ["glob:'**/*.go'"]

[fix.tools.1-ruff-lint]
command = ["uv", "run", "ruff", "check", "--fix", "--quiet", "--stdin-filename=$path", "-"]
patterns = ["glob:'**/*.py'"]

[fix.tools.2-ruff-format]
command = ["uv", "run", "ruff", "format", "--stdin-filename=$path", "-"]
patterns = ["glob:'**/*.py'"]
